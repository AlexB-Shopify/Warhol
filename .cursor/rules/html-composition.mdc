---
description: Guidance for composing the branded HTML slide deck — the primary creative output that drives both the browser preview and the PPTX build. Used during Step 6 of the generate-presentation workflow.
globs:
alwaysApply: false
---

# HTML Composition

You are composing a fully branded HTML slide deck. This HTML file is not a "preview" — it IS the presentation. It must look correct in a browser and serve as the exact specification the PPTX builder reproduces.

## Design System Tokens

The scaffold HTML (`render_html.py`) injects the design system as CSS custom properties. Use these tokens instead of hardcoding hex values:

### Colors
```css
var(--color-primary)          /* Brand accent, e.g., #CDF986 */
var(--color-secondary)        /* Dark brand, e.g., #191E17 */
var(--color-accent)           /* Light accent, e.g., #F4F4F4 */
var(--color-text-dark)        /* Dark text, e.g., #434343 */
var(--color-text-light)       /* Light text (for dark slides), e.g., #FFFFF6 */
var(--color-background)       /* Default background, e.g., #000000 */
var(--color-surface)          /* Card/surface fill, e.g., #F4F4F4 */
var(--color-text-secondary)   /* Secondary body text */
var(--color-text-heading)     /* Heading text */
var(--color-data-point-accent) /* Hero number accent color */
```

### Slide-Type Backgrounds
```css
var(--bg-title)               /* Title slide background */
var(--bg-section-header)      /* Section header background */
var(--bg-content)             /* Standard content slide */
var(--bg-closing)             /* Closing slide */
var(--bg-quote)               /* Quote slide */
var(--bg-bullet-list)         /* Bullet list slide */
```

### Fonts
```css
var(--font-title)             /* Title font family */
var(--font-body)              /* Body text font */
var(--font-emphasis)          /* Bold/emphasis font */
var(--font-light)             /* Light-weight font */
var(--font-extra-light)       /* Display/hero number font */
var(--font-label)             /* Labels and markers */
var(--font-quote)             /* Quote text */
```

### Sizes
```css
var(--size-title)             /* Title font size */
var(--size-subtitle)          /* Subtitle font size */
var(--size-body)              /* Body text font size */
var(--size-bullet)            /* Bullet text font size */
var(--size-data-point)        /* Hero number font size */
var(--size-label)             /* Label font size */
```

### Spacing
```css
var(--margin-left)            /* Content left margin */
var(--margin-top)             /* Content top margin */
var(--margin-right)           /* Content right margin */
var(--margin-bottom)          /* Content bottom margin */
```

## Auto-Styling

The CSS includes rules that auto-apply backgrounds per `data-slide-type`:
- Setting `data-slide-type="title"` on a `.slide` div and using `.slide-bg-auto` gives it `var(--bg-title)` automatically
- Setting `data-visual-profile="dark"` gives all child elements `color: var(--color-text-light)` automatically

You can override these with explicit inline styles on any element.

## HTML Format

### Slide Dimensions

960px x 540px (10" x 5.625" at 96 DPI). All positions in px. Conversion: `px / 96 = inches`.

### Slide Structure

```html
<div class="slide-wrapper">
<div class="slide"
     data-slide-number="1"
     data-slide-type="content"
     data-visual-profile="dark">

  <!-- Background: template clone or solid -->
  <div class="slide-bg slide-bg-template"
       data-bg-type="template_clone"
       data-template-file="templates/base/Shopify - Example Technical Workshop Slide Bank.pptx"
       data-slide-index="42"
       style="background:#000000;">
  </div>

  <!-- Text elements with explicit positioning and styling -->
  <div class="element" data-role="title"
       style="position:absolute; left:51px; top:53px; width:500px; height:62px;
              font-family:var(--font-emphasis); font-size:var(--size-title);
              color:var(--color-text-light); font-weight:bold; text-align:left;">
    Slide Title Here
  </div>

  <div class="element" data-role="bullets"
       style="position:absolute; left:51px; top:150px; width:550px; height:300px;
              font-family:var(--font-body); font-size:var(--size-body);
              color:var(--color-text-light); line-height:1.5;">
    <ul>
      <li>First point</li>
      <li>Second point</li>
      <li>Third point</li>
    </ul>
  </div>

  <div class="speaker-notes">Speaker notes text here...</div>
</div>
<div class="slide-label">Slide 1 — content</div>
</div>
```

### Background Types

**Template clone** — clones a branded slide from PPTX (preserving backgrounds, images, decorations). Best for content slides with complex branded visuals:
```html
<div class="slide-bg slide-bg-template"
     data-bg-type="template_clone"
     data-template-file="templates/base/Shopify - Example Technical Workshop Slide Bank.pptx"
     data-slide-index="42"
     style="background:#000000;">
</div>
```
The inline `style="background:..."` shows the template's actual color in the browser preview. The PPTX builder clones the template slide for its background, then clears all original text and adds new text boxes at the HTML-specified positions.

**Solid color** — a branded background color. **Use this for section headers, quotes, and any slide with simple backgrounds** where you don't need complex template visuals:
```html
<div class="slide-bg slide-bg-solid"
     data-bg-type="solid"
     style="background:#000000;">
</div>
```

**Auto** — background set automatically by slide type:
```html
<div class="slide-bg slide-bg-auto" data-bg-type="solid"></div>
```

### When to Use Solid vs Template Clone

| Slide Type | Recommended Background | Reason |
|---|---|---|
| title, closing | template_clone | Need rich branded imagery |
| section_header | **solid** | Simple dark background, template clone can pick wrong layout |
| content, bullet_list | template_clone | Branded visual context |
| quote | solid or template_clone | Depends on desired visual weight |
| data_point | template_clone | Branded visual context |
| two_column, comparison | template_clone | Layout comes from template |

Section headers should always use `data-bg-type="solid"` with an explicit background color to avoid template matching issues where the cloned template may have a different visual design (e.g., two-tone vertical sections) than intended.

### Text Elements

Required inline CSS properties (map 1:1 to PPTX):
- `left`, `top`, `width`, `height` — px at 96 DPI
- `font-family` — font name or `var(--font-*)` token
- `font-size` — in pt or `var(--size-*)` token
- `color` — hex RGB or `var(--color-*)` token

Optional: `font-weight:bold`, `font-style:italic`, `text-align`, `line-height`

Required data attribute: `data-role` (title, subtitle, body, bullets, quote, caption, data_point, section_marker, label)

Optional data attribute: `data-shape-name` — for cloned slides, targets a specific shape by name

### Bullet Lists

```html
<div class="element" data-role="bullets" style="...">
  <ul>
    <li>Point one</li>
    <li>Point two</li>
  </ul>
</div>
```

### Image Placeholders

Use image placeholders to indicate where images, illustrations, diagrams, or photos should go. The PPTX builder creates a labeled rectangle with a dashed border — the presenter (or a future image pipeline) can replace it with actual imagery.

```html
<div class="element image-placeholder"
     data-role="image_placeholder"
     data-image-description="Architecture diagram showing microservices topology"
     data-image-style="diagram"
     style="position:absolute; left:500px; top:100px; width:400px; height:350px;
            background:var(--color-surface); border:2px dashed var(--color-text-light);
            display:flex; align-items:center; justify-content:center;
            font-family:var(--font-label); font-size:var(--size-label);
            color:var(--color-text-light); font-style:italic; text-align:center;">
  <span class="placeholder-label">Architecture diagram</span>
</div>
```

**Required attributes:**
- `data-role="image_placeholder"` — tells the PPTX builder to create a placeholder shape
- `data-image-description` — descriptive text for the placeholder label (what the image should depict)

**Optional attributes:**
- `data-image-style` — hints at the type of visual:
  - `diagram` — architecture, flow, or process diagrams
  - `chart` — data visualization
  - `photo` — real photography
  - `illustration` — stylized illustration or icon set
  - `screenshot` — product/UI screenshot
  - `icon` — simple icon or symbol

**When to use placeholders:**
- The slide's visual intent calls for an image, diagram, or illustration
- The content would be stronger with a visual but no suitable template image exists
- A data visualization or chart is described in the content but can't be auto-generated

**Positioning rules:**
- Place placeholders where images belong in the layout (right column, below content, full-width)
- Size appropriately for the content type: diagrams need ~400x350px, photos ~300x250px, icons ~80x80px
- Don't overlap with text elements — leave clear spatial separation

### Speaker Notes

```html
<div class="speaker-notes">Notes text here...</div>
```

### Decoration Patterns

Use decoration patterns to add visual richness to compose-mode slides. These are shape elements (not text) that the PPTX builder reproduces as PowerPoint shapes.

Decoration elements use the `.decoration` class (not `.element`) and are separate from content. Position them with the same absolute CSS.

**Numbered badge** — circle with a number inside (for numbered lists, step indicators):
```html
<div class="decoration numbered-badge"
     style="position:absolute; left:51px; top:150px; width:36px; height:36px;
            background:var(--color-badge-fill); color:var(--color-badge-text);">
  1
</div>
```

**Accent card** — rounded rectangle with colored left border (for key points, callouts):
```html
<div class="decoration accent-card"
     style="position:absolute; left:100px; top:200px; width:350px; height:80px;
            background:var(--color-surface); color:var(--color-text-dark);">
  Key insight or callout text here
</div>
```

**Divider line** — horizontal rule between content sections:
```html
<div class="decoration divider-line"
     style="position:absolute; left:51px; top:300px; width:858px; height:1px;">
</div>
```

**Icon placeholder** — small circle for an icon or avatar:
```html
<div class="decoration icon-placeholder"
     style="position:absolute; left:51px; top:200px; width:40px; height:40px;">
  icon
</div>
```

**Image frame** — decorative frame for an image placeholder with caption:
```html
<div class="decoration image-frame"
     style="position:absolute; left:500px; top:100px; width:400px; height:300px;">
  Product screenshot
</div>
```

**When to use decoration patterns:**
- Compose-mode slides that need visual structure beyond just text
- Numbered step layouts (badge + text pairs)
- Callout boxes or highlighted insights
- Visual separation between content sections
- Icon + text row layouts for features or benefits
- Pair decoration with `.element` text divs for rich layouts

## Contrast Rules

Every slide MUST have readable text. Background-font color mismatches (white on white, black on black) are the most common visual defect.

### Mandatory Rules

1. **Every slide MUST have an explicit `data-visual-profile` attribute** — either `"dark"` or `"light"`. Never omit it.
2. **Every slide MUST have an explicit background** — either `template_clone` with an inline fallback color, or `solid` with a hex color. Never leave a slide with no background specification.
3. **Dark backgrounds (luminance < 0.4) MUST use `var(--color-text-light)`** for all text elements.
4. **Light backgrounds (luminance > 0.6) MUST use `var(--color-text-dark)` or `var(--color-text-heading)`** for all text elements.

### Quick Reference

| Background Color | Visual Profile | Text Color Token |
|---|---|---|
| `#000000` - `#333333` | dark | `var(--color-text-light)` |
| `#191E17` (brand dark) | dark | `var(--color-text-light)` |
| `#F4F4F4` - `#FFFFFF` | light | `var(--color-text-dark)` |
| `var(--color-primary)` (#CDF986) | light | `var(--color-text-dark)` |

### How to Check

Before finalizing each slide, verify: "Is my text color the opposite luminance band from my background?" If both are dark or both are light, fix the text color.

The PPTX builder runs a post-build contrast enforcement pass, but it is better to get colors right in the HTML.

## Font Sizing and Overflow Prevention

Text that fits in an HTML `<div>` may overflow a PPTX textbox because PowerPoint does not auto-shrink text the same way a browser does. Follow these limits to avoid clipped or overlapping text.

### Safe Maximum Font Sizes

| Zone | Max Font Size | Notes |
|---|---|---|
| Title | 36pt | Use `var(--size-title)`. Reduce for titles > 40 chars |
| Subtitle | 22pt | Use `var(--size-subtitle)` |
| Body text | 18pt | Use `var(--size-body)`. Reduce to 16pt for > 300 chars |
| Bullets | 16pt | Use `var(--size-bullet)`. Reduce to 14pt for 6 items |
| Data point (hero number) | 88pt | Only for short strings (< 6 chars) |
| Labels / captions | 12pt | Use `var(--size-label)` |

### Length-Based Sizing

When text content is longer, reduce the font size proactively:

- **< 100 chars**: Use the zone default
- **100-200 chars**: Reduce by 2pt from the zone default
- **200-400 chars**: Reduce by 4pt from the zone default
- **> 400 chars**: Use 14pt max for body, 12pt for bullets

### Rules

- Never set a font-size that would cause text to exceed its `height`. If unsure, use a smaller size.
- Titles over 60 characters should use `var(--size-subtitle)` instead of `var(--size-title)`.
- Bullet lists with 5+ items should use 14pt max.
- The PPTX builder applies a post-placement fit check and will reduce oversized fonts automatically, but it is better to get the size right in HTML.

## Layout Grid and Positioning

All elements use absolute CSS positioning on a 960x540px canvas. Follow these safe zones and layout templates to avoid overlaps, edge clipping, and illogical placement.

### Safe Zones

| Zone | Position | Purpose |
|---|---|---|
| Title | `top: 30-80px, left: 51px, width: 858px` | Slide titles |
| Subtitle | `top: 80-120px, left: 51px, width: 858px` | Subtitles, below title |
| Body | `top: 120-480px, left: 51px, width: 858px` | Main content area |
| Footer/caption | `top: 480-520px, left: 51px, width: 858px` | Source labels, captions |

### Margins

- **Left/right**: minimum 51px from each edge (leaves a ~5% margin)
- **Top**: minimum 30px from top edge
- **Bottom**: minimum 20px from bottom edge (below y=520px is reserved)
- **Element gap**: minimum 10px between adjacent text elements

### Layout Templates

Use these predefined position sets for common slide types. Copy the exact coordinates for consistent results.

**Single-column content:**
```
Title:    left:51px; top:40px;  width:858px; height:55px
Body:     left:51px; top:130px; width:858px; height:350px
Caption:  left:51px; top:490px; width:858px; height:30px
```

**Two-column:**
```
Title:    left:51px;  top:40px;  width:858px; height:55px
Left col: left:51px;  top:130px; width:410px; height:350px
Right col:left:500px; top:130px; width:410px; height:350px
```

**Data point (hero number):**
```
Number:   left:51px; top:100px; width:500px; height:180px
Context:  left:51px; top:310px; width:600px; height:80px
Caption:  left:51px; top:420px; width:400px; height:30px
```

**Quote:**
```
Quote:    left:80px; top:120px; width:800px; height:200px
Author:   left:80px; top:340px; width:400px; height:40px
```

**Image + text (right image):**
```
Title:    left:51px;  top:40px;  width:858px; height:55px
Text:     left:51px;  top:130px; width:420px; height:350px
Image:    left:500px; top:130px; width:400px; height:350px
```

### Positioning Rules

1. **Never place text below y=500px** — the bottom 40px is reserved for slide labels and should not contain content.
2. **Never place text elements that overlap each other.** When two elements would overlap, move the lower one down or reduce the height of the upper one.
3. **Leave at least 10px gap** between adjacent text elements vertically.
4. **Keep all elements within the slide bounds** — no `left + width > 960` or `top + height > 540`.
5. **Use the same position template across similar slides** — all bullet_list slides should have body text at the same coordinates for visual consistency.
6. **Title positioning should be consistent** across all slides (same left/top/width). Varying title positions between slides looks unprofessional.

## Composition Principles

### 1. The HTML Must Look Correct in a Browser

Open the HTML file and check it. Every slide should look like a branded presentation slide — correct colors, readable text, proper layout. If it looks wrong in the browser, it will look wrong in the PPTX.

### 2. Use Design System Tokens Everywhere

Never hardcode a hex color that's available as a token. Use `var(--color-primary)` not `#CDF986`. This ensures the HTML stays correct if the design system changes.

### 3. Content Fits the Template, Not the Other Way Around

For template-cloned slides, the template defines the visual layout. Trim content to fit. Move overflow to speaker notes. The slide should be sharp and minimal; the notes hold the full narrative.

### 4. Visual Consistency

- All section headers use the same template and visual style
- Title and closing slides feel like bookends
- Body content slides have consistent text placement
- Font usage is predictable across all slides

### 5. Slides Are Visual, Notes Are Verbal

Less text on slides, more in speaker notes. A well-designed slide has a clear title, 3-4 bullet points max, and generous whitespace. The speaker notes contain the full narrative the presenter will deliver.

## Using Template Content

When a slide uses `template_clone`, the PPTX builder clones a branded template slide — preserving its backgrounds, images, and decorative elements. To get the most value from templates:

### Preserving Template Images

If the template slide has useful imagery (branded graphics, product screenshots, decorative photos), tell the builder to keep them:

```html
<div class="slide-bg slide-bg-template"
     data-bg-type="template_clone"
     data-template-file="templates/base/Shopify - Example Technical Workshop Slide Bank.pptx"
     data-slide-index="42"
     data-preserve-images="true"
     style="background:#000000;">
</div>
```

When `data-preserve-images="true"` is set, the builder only clears text shapes — images, grouped shapes with images, and decorative elements stay in place.

### Positioning Around Template Content

When preserving template images, position your text elements to complement the existing imagery:

- Check the template slide's `content_zones` in the registry — these tell you where the safe text areas are
- Don't place text elements on top of preserved images
- Use the image as visual context and position text adjacent to it
- If the template has a right-side image, put your text on the left (and vice versa)

### When to Preserve vs. Clear

| Template Content | Preserve? | Reason |
|---|---|---|
| Branded background patterns, gradients | Always preserved (part of background) | |
| Product screenshots, diagrams | `data-preserve-images="true"` if relevant | Adds visual richness |
| Decorative icons, shapes | `data-preserve-images="true"` if they fit | Brand consistency |
| Template placeholder text | Always cleared | Replaced with real content |
| Irrelevant stock photos | Don't preserve (omit the attribute) | Would confuse the message |

### Template Registry Reference

When choosing templates, check the `decoration_assets` field in the template registry. Templates with relevant images, icons, or branded decorations are more valuable than blank layouts. Prefer templates whose visual assets match the slide's content theme.

## Building from the HTML

Once the HTML is complete:

```
python scripts/build_from_html.py workspace/deck_preview.html \
    -o output/presentation.pptx \
    --base-template "templates/base/Shopify - Example Technical Workshop Slide Bank.pptx"
```

Copy the HTML to the output folder too:
```
cp workspace/deck_preview.html output/presentation.html
```

Both `output/presentation.pptx` and `output/presentation.html` should be identical in content, layout, and branding.
