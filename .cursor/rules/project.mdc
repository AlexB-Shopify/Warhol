---
description: Warhol project context -- directory structure, conventions, and how to work in this repo
globs:
alwaysApply: true
---

# Warhol -- Cursor-Native Presentation Generator

This project generates PowerPoint presentations from input documents (PDF, DOCX, PPTX, TXT, MD).
The Cursor agent acts as the LLM -- there are no external API keys or LLM dependencies.
Python scripts handle deterministic operations (parsing, HTML rendering, PPTX building, validation).

## Directory Structure

```
.cursor/rules/          -- Agent rules and workflow definitions
scripts/                -- Standalone Python scripts the agent runs via terminal
  parse_input.py        -- Parse input documents to text
  validate_schema.py    -- Validate JSON against Pydantic schemas
  render_html.py        -- Render branded HTML deck from schema + design system
  build_from_html.py    -- Build PPTX from HTML slide deck (primary builder)
  build_slides.py       -- Build PPTX from deck schema (legacy, fallback)
  quality_check.py      -- Run programmatic quality checks on PPTX
  analyze_templates.py  -- Extract structural metadata from template PPTX files
  extract_design_system.py -- Extract design system (fonts/colors) from PPTX
  match_templates.py    -- Algorithmic template matching with consistency groups
  assess_content_density.py -- Flag slides where content exceeds template capacity
  spread_content.py     -- Split over-dense slides into multiple output slides
workspace/              -- Working directory for intermediate pipeline files (JSON, TXT, HTML)
output/                 -- Final output directory (PPTX + HTML)
src/
  parsers/              -- Document parsers (PDF, DOCX, PPTX, TXT/MD) -- pure Python
  pptx_engine/          -- PPTX manipulation (slides, text, shapes, images) -- pure Python
  schemas/              -- Pydantic models for all data structures
  agents/               -- Slide builder (PPTX construction, no LLM)
  utils/                -- File I/O utilities
design_systems/         -- YAML design system configurations
templates/              -- PPTX template bank (corporate, creative, minimal)
```

## Key Conventions

- All intermediate pipeline data is written to `workspace/` as JSON/HTML files
- Final outputs go to `output/` (presentation.pptx + presentation.html)
- Scripts are run from the project root: `python scripts/<script>.py [args]`
- Pydantic schemas in `src/schemas/` define the exact JSON structures for all pipeline data
- The agent produces JSON matching these schemas; scripts validate them
- Template registry (`template_registry.json`) is generated by the analyze-templates workflow
- Design systems (`design_systems/*.yaml`) configure fonts, colors, and branding
- The design system is injected into HTML as CSS custom properties (`var(--token)`)

## Agent Behavior

- `orchestrator.mdc` -- how the agent operates, routes requests, manages the workspace
- `author.mdc` -- presentation authoring expertise (titles, bullets, speaker notes, tone)

## 8-Step Pipeline

The generate-presentation workflow follows 8 clear phases:

1. Parse input document
2. Assess content maturity (Level 1-4)
3. Extract structured content inventory
4. Research / write / edit content (adapts per maturity)
5. Organize content into slides (deck schema)
6. Build branded HTML deck (primary creative output)
7. Build PPTX from HTML (mechanical reproduction)
8. Quality check and deliver

Content rules (Steps 1-5):
- `content-maturity.mdc` -- assesses input readiness (Level 1-4)
- `research-agent.mdc` -- scaffolds full outline from raw ideas (Level 1)
- `content-development.mdc` -- crafts slide-by-slide content and story (Level 1-2)
- `editor-agent.mdc` -- polishes titles, bullets, speaker notes (Level 1-3)
- `narrative-architecture.mdc` -- builds deck plan from ready content (Level 4)
- `content-extraction.mdc` -- extracts structured content from documents (all levels)

Design rules (Step 6):
- `html-composition.mdc` -- composes the branded HTML presentation (the primary creative output)
- `template-matching.mdc` -- guidance for matching slides to templates

## Available Workflows

1. **Generate Presentation** -- see `generate-presentation.mdc`
2. **Analyze Templates** -- see `analyze-templates.mdc`
3. **Extract Design System** -- see `extract-design-system.mdc`

## Base Template

The default base template is `templates/base/Shopify - Example Technical Workshop Slide Bank.pptx`. It provides:
- Rich Shopify-branded backgrounds on every slide layout
- 15 layout types (title, section header, content, two-column, etc.)
- 179 example slides that can be used as drop-in candidates via the template registry
- 10"x5.625" dimensions (standard widescreen)

The builder strips existing slides from the base template (keeping only layouts/masters) and builds fresh slides using the branded layouts.

## Schema Reference

All JSON the agent produces must conform to these Pydantic models in `src/schemas/`:

- `ContentMaturity` (slide_schema.py) -- content maturity assessment and pipeline routing
- `ContentInventory` (slide_schema.py) -- extracted content from input documents
- `DeckSchema` (slide_schema.py) -- complete slide-by-slide deck specification
- `MatchResult` (defined in validate_schema.py) -- template-to-slide matches
- `TemplateRegistry` (template_schema.py) -- analyzed template metadata
- `DesignSystem` (design_system.py) -- font and color configuration
- `HtmlDeck` (html_schema.py) -- HTML intermediate deck specification
