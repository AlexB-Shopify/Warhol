---
description: Workflow for generating a PowerPoint presentation from an input document. Use when the user asks to generate, create, build, or make a presentation or slide deck.
globs:
alwaysApply: false
---

# Generate Presentation Workflow

Follow these 8 steps to generate a PowerPoint presentation from an input document. Steps 1-5 are purely content work. Step 6 is where all design decisions happen. Steps 7-8 build and deliver.

## Prerequisites

- Input document exists (PDF, DOCX, PPTX, TXT, or MD)
- Design system YAML exists in `design_systems/` (use the appropriate brand YAML)
- Python environment is set up with dependencies from `pyproject.toml`
- Template registry exists at `template_registry.json` (run the analyze-templates workflow first if missing)

---

## Step 1: Parse the Input Document

Run the parser script to extract text content:

```
python scripts/parse_input.py <input_file> -o workspace/parsed_content.txt
```

Verify the output file was created and has content.

## Step 2: Assess Content Maturity

Read `workspace/parsed_content.txt` and assess how ready the content is for a presentation.

Follow the guidance in the **content-maturity** rule. Write the result to `workspace/content_maturity.json`.

```
python scripts/validate_schema.py workspace/content_maturity.json ContentMaturity
```

**Report the assessment to the user** — tell them the maturity level (1-4), what stages will run, and key gaps/strengths. Ask if they agree or want to override.

The maturity level determines which sub-steps run in Step 4:

| Level | Label | Step 4 includes |
|---|---|---|
| 1 | Raw ideas | Research → Content Development → Editor |
| 2 | Outline | Content Development → Editor |
| 3 | Draft | Editor only |
| 4 | Ready | Narrative Architecture only |

## Step 3: Extract Content Inventory

Read `workspace/parsed_content.txt` and produce a structured content inventory.

Follow the guidance in the **content-extraction** rule. Write the result to `workspace/content_inventory.json`.

```
python scripts/validate_schema.py workspace/content_inventory.json ContentInventory
```

## Step 4: Research, Write, and Edit Content

This step adapts based on content maturity. All sub-steps below are about **content only** — no design decisions yet.

### Level 1: Research Agent

Follow the **research-agent** rule. Read `workspace/content_inventory.json` and produce `workspace/researched_outline.json`.

### Levels 1-2: Content Development Agent

Follow the **content-development** rule. Read the latest artifact and produce `workspace/developed_content.json`.

### Levels 1-3: Editor Agent

Follow the **editor-agent** rule. This polishes titles, tightens bullets, refines speaker notes, and ensures narrative flow.

### Level 4: Narrative Architecture

Follow the **narrative-architecture** rule. Read `workspace/content_inventory.json` and produce the deck plan directly.

## Step 5: Organize Content into Slides

The output of Step 4 is `workspace/deck_schema.json` — a complete slide-by-slide specification with titles, content blocks, speaker notes, slide types, and layout hints.

Validate it:

```
python scripts/validate_schema.py workspace/deck_schema.json DeckSchema
```

If validation fails, fix and re-validate. The deck schema must be complete and correct before proceeding to design.

**At this point, all content work is done.** Every slide has its final text, bullets, speaker notes, and narrative intent. Steps 6+ are purely about visual design and building.

## Step 6: Build Branded HTML Deck

This is the core creative step — where content meets design. The output is a fully branded HTML file that is both a browser-viewable presentation and the precise specification for the PPTX builder.

Follow the guidance in the **html-composition** rule.

### 6a. Run template matching

If `template_registry.json` exists:

```
python scripts/match_templates.py workspace/deck_schema.json template_registry.json -o workspace/template_matches.json
```

### 6b. Generate scaffold HTML

Run the renderer to auto-generate an initial branded HTML from the deck schema:

```
python scripts/render_html.py workspace/deck_schema.json \
    -o workspace/deck_preview.html \
    --design-system <design_system_yaml> \
    --matches workspace/template_matches.json \
    --template-registry template_registry.json
```

The scaffold includes:
- CSS custom properties from the design system (all brand colors, fonts, sizes as `var(--token)`)
- Auto-styling rules per slide type and visual profile
- Template background colors for accurate branded preview
- Content mapped to template zones

### 6c. Compose the final HTML

Read `workspace/deck_preview.html` and compose the branded presentation. This is where you make every design decision:

- Edit text to fit template zones (move overflow to speaker notes)
- Set element positions, sizes, fonts, and colors using the design system tokens
- Choose backgrounds per slide (template clone or solid brand color)
- Ensure visual consistency (section headers match, bookend slides match)
- Manage content density (trim rather than overflow)

Write the final HTML back to `workspace/deck_preview.html`.

The HTML file should look like a polished presentation when opened in a browser.

## Step 7: Build PPTX from HTML

Run the HTML-to-PPTX builder:

```
python scripts/build_from_html.py workspace/deck_preview.html \
    -o output/presentation.pptx \
    --base-template "templates/base/Shopify - Example Technical Workshop Slide Bank.pptx"
```

The builder mechanically reproduces the HTML:
- Template-cloned backgrounds: clones the referenced slide from the PPTX template
- Solid backgrounds: creates a slide from the base template layout
- Text elements: placed at exact CSS positions with specified fonts, sizes, colors
- Speaker notes: transferred from hidden divs

Also copy the final HTML alongside the PPTX:

```
cp workspace/deck_preview.html output/presentation.html
```

## Step 8: Quality Check and Deliver

Run programmatic quality checks:

```
python scripts/quality_check.py output/presentation.pptx --design-system <design_system_yaml> --describe
```

Follow the **quality-review** rule to provide a narrative assessment.

Report to the user:
- Slide count and quality summary
- Output files: `output/presentation.pptx` and `output/presentation.html`
- Any issues that need attention

---

## Pipeline Summary

```
Input Document
    │
    ▼
1. [Parse] ──► parsed_content.txt
    │
    ▼
2. [Assess Maturity] ──► content_maturity.json
    │
    ▼
3. [Extract Content] ──► content_inventory.json
    │
    ▼
4. [Research / Write / Edit] ──► deck_schema.json
    │   (adapts per maturity level)
    │
    ▼
5. [Validate Deck Schema] ──► content complete, ready for design
    │
    ▼
6. [Build Branded HTML] ──► deck_preview.html
    │   ├── template matching (algorithmic)
    │   ├── scaffold generation (render_html.py)
    │   └── agent composes final branded HTML
    │
    ▼
7. [Build PPTX from HTML] ──► output/presentation.pptx
    │                          output/presentation.html
    ▼
8. [Quality Check] ──► quality_report.json
```

## Error Handling

- If any script fails, read the error output and fix the issue
- If JSON validation fails, review the schema definition in `src/schemas/` and correct the JSON
- If the build step fails, check that the HTML is well-formed
- If quality issues are severe, edit `workspace/deck_preview.html` and re-run Step 7
- If the user disagrees with the maturity assessment, let them override and adjust the pipeline
